{% extends "base.html" %}

{% block content %}
<div class="product-detail-sect">
    <div class="product-detail">

        <img src="{{ product.ImageURL if product.ImageURL else 'https://via.placeholder.com/150' }}"
             alt="{{ product.Title }}"
             style="max-width: 400px; height: auto; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">

        <h2 class="product-title">{{ product.Title }}</h2>
        <p class="product-description">{{ product.Description }}</p>
        <p class="product-category">Category: {{ product.Category }}</p>

        <p>
            {% if product.OriginalPrice and product.OriginalPrice > product.DiscountedPrice %}
                <span class="original-price">
                    ${{ "%.2f"|format(product.OriginalPrice) }}
                </span>
                <span class="discounted-price">
                    ${{ "%.2f"|format(product.DiscountedPrice) }}
                </span>
                {% if product.DiscountTime %}
                    {% set time_left = product.DiscountTime - current_time %}
                    {% if time_left.total_seconds() > 0 %}
                        <br>
                        <small class="discount-countdown">
                            Discount ends in: {{ time_left.days }}d {{ (time_left.seconds // 3600) % 24 }}h {{ (time_left.seconds // 60) % 60 }}m
                        </small>
                    {% else %}
                        <br>
                        <small class="discount-countdown">Discount has ended</small>
                    {% endif %}
                {% endif %}
            {% else %}
                <span class="discounted-price">
                    ${{ "%.2f"|format(product.DiscountedPrice) }}
                </span>
            {% endif %}
        </p>

        <p class="product-warranty">Warranty: {{ product.WarrantyPeriod }} month(s)</p>
        <p class="product-inventory">In Stock: {{ product.Inventory }}</p>

        <form action="{{ url_for('add_to_cart', product_id=product.ProductID) }}" method="post">

            {% if product.colors %}
                <label for="color">Color:</label>
                <select name="color" id="color">
                    {% for color in product.colors %}
                        <option value="{{ color }}">{{ color }}</option>
                    {% endfor %}
                </select>
            {% endif %}

            {% if product.sizes %}
                <label for="size">Size:</label>
                <select name="size" id="size">
                    {% for size in product.sizes %}
                        <option value="{{ size }}">{{ size }}</option>
                    {% endfor %}
                </select>
            {% endif %}

            <label for="quantity">Quantity:</label>
            <input type="number" name="quantity" id="quantity" value="1" min="1">

            <button class="cta-button" type="submit">Add to Cart</button>
        </form>

        <div class="product-nav-buttons" style="margin-top: 20px;">
            <a href="{{ url_for('products') }}" class="cta-button" style="margin-right: 10px;">‚Üê Back to Products</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <ul class="flashes">
                    {% for category, message in messages %}
                        <li class="flash {{ category }}">{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}

    </div>
</div>
{% endblock %}
